#!/bin/dash

# /usr/bin/firstrun: a first-run welcome screen
# dependencies: gtkdialog, system_settings and netsurf

# include the distribution information file
. /etc/distrorc

# include the default configuration file
. /etc/desktoprc

# include the user's configuration file
[ -f ~/.desktoprc ] && . ~/.desktoprc

# the title
TITLE="Welcome"

# the "welcome" message
WELCOME_MESSAGE="Welcome!"

# the main area text
TEXT="This is the first time you are running $DISTRO_NAME."

# the logo to display
LOGO="/usr/share/pixmaps/distro.png"

# the window manager
if [ -n "$WINDOW_MANAGER" ]
then
	window_manager="$WINDOW_MANAGER"
else
	window_manager="$DEFAULT_WINDOW_MANAGER"
fi

# filter the window manager name
window_manager="$(basename `echo $window_manager | cut -f 1 -d \ `)"

echo -n "
<window title=\"$TITLE\">
	<vbox>
		<vbox>
			<text><label>$WELCOME_MESSAGE</label></text>
			<pixmap>
				<input file>$LOGO</input>
			</pixmap>
			<text><label>$TEXT</label></text>
		</vbox>
		<vbox>
			<button>
				<label>About $DISTRO_NAME</label>
				<input file stock=\"gtk-about\"></input>
				<action>netsurf file:///usr/share/doc/distro/about.html &</action>
			</button>
			<button>
				<label>What's new in version $DISTRO_VERSION?</label>
				<input file stock=\"gtk-add\"></input>
				<action>netsurf file:///usr/share/doc/distro/changelog.html &</action>
			</button>
			<button>
				<label>Configure the system</label>
				<input file stock=\"gtk-preferences\"></input>
				<action>system_settings &</action>
			</button>
			<button>
				<label>$window_manager documentation</label>
				<input file stock=\"gtk-fullscreen\"></input>
				<action>urxvt -title $window_manager -e man $window_manager &</action>
			</button>
			<button>
				<label>$DISTRO_NAME documentation</label>
				<input file stock=\"gtk-help\"></input>
				<action>netsurf file:///usr/share/doc/distro/index.html &</action>
			</button>
		</vbox>
		<hseparator></hseparator>
		<hbox>
			<button ok></button>
		</hbox>
	</vbox>
</window>" | gtkdialog -s
